{
  "name": "kartotherian-core",
  "version": "0.0.0",
  "description": "The core components of the Kartotherian maps tile service",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/kartotherian/kartotherian-core.git"
  },
  "author": {
    "name": "Yuri Astrakhan",
    "email": "YuriAstrakhan@gmail.com"
  },
  "license": "Apache 2.0",
  "bugs": {
    "url": "https://github.com/kartotherian/kartotherian-core/issues"
  },
  "dependencies": {
    "bluebird": "^2.9.24",
    "js-yaml": "^3.2.7",
    "mapnik": "~3.4.0",
    "underscore": "^1.8.3",
    "xmldoc": "git+https://github.com/nyurik/xmldoc.git"
  },
  "readme": "# kartotherian-core\n\nThe core components of the Kartotherian maps tile service\n\n## Sources\nSources is a way to set up data processing pipelines for Kartotherian and Tilerator.\nSources could be either stored in a set of standalone files, or be embedded in the\nmain configuration file, or a mix of both. The sources value in the config file\ncould be a string (file), an object defining the source, or an array of strings and objects.\n\n`uri` is the only mandatory field, and it specifies how [tilelive.js](https://github.com/mapbox/tilelive.js)\nwill locate and initialize the new source. The protocol determines which tile provider will be used.\n\nSince sometimes not everything can be added as query parameters to the Uri, there is a set of additional keys to help.\nValues can either be hardcoded as strings/numbers/booleans, or can be calculated on the fly.\n\nA simple source configuration to set up a tile storage as files in the ./vectors dir:\n```\nfilestore:\n    uri: file://./vectors\n```\nThe path can also be set via a parameter:\n```\nfilestore:\n    uri: file://\n    pathname: ./vectors\n```\nThe value does not have to be given in the source, but instead could be dynamically generated.\nFor example, the `var` generator pulls the value from the variable store.\nThe variables are defined in a separate file(s), similar to sources.\n```\nfilestore:\n    uri: file://\n    pathname: {var: tilepath}  # Uses a variable named tilepath\n```\n\nMore parameters can be set using `params` - a set of additional values to be set in URI:\n```\noz:\n  # \"overzoom:\" is a tile source that will attempt to get a tile from another source,\n  # and if tile is missing, attempt to get a portion of the lower-zoom tile.\n  uri: overzoom://\n  # Specify the tile source - this adds a properly escaped query parameter\n  #   ?source=sourceref:///?ref=gen\n  param:\n    source: {ref: gen}\n```\n\n## Value substitutions\n\nIn general, these value substitutions are available:\n* `{var:varname}` - the value becomes the value of the variable `varname` from the variables file / variables conf section of the main config file. This might be useful if you want to make all the settings public except for the passwords that are stored in a secure location.\n* `{ref:sourceId}` - the value becomes a reference to another source. Some sources function as filters/converters, pulling data internally from other sources and converting the result on the fly. For example, the [overzoom](https://github.com/kartotherian/kartotherian-overzoom) source pulls data from another source, and if it's not available, tries to find a lower-zoom tile above the given one, and extract a portion of it. Internally, it uses a forwarding sourceref: source.\n* `{npm: ['npm-module-name', 'subdir', 'subdir', 'filename']}`\nSome files may be located inside the NPM modules added to the Kartotherian project, i.e. [osm-bright-source](https://github.com/kartotherian/osm-bright.tm2source). To reference a file inside npm, set npm's value to an array, with the first value being the name of the npm module (resolves to the root of the npm module), and all subsequent strings being subdirs and lastly - the name of the file. Subdirs may be ommited:\n```\n# resolves to a rooted path ..../node_modules/osm-bright-source/data.xml\nnpm: [\"osm-bright-source\", \"data.xml\"]\n```\n\n## XML-based sources\nThe `xml` parameter is used to load and alter XML for some sources like\n[tilelive-bridge](https://github.com/mapbox/tilelive-bridge) (SQL→VectorTile or TIFF→RasterTile) and\n[tilelive-vector](https://github.com/mapbox/tilelive-vector) (Style VectorTile → PNG).\nThe `xml` field must evaluate to the xml file path.\n\n```\ngen:                # The name of the source (could be referenced later)\n  uri: bridge://    # Required - the URI used to construct the source\n  xml:              # Init source with this xml instead of the URI's other parameters\n    # Set xml to the location of the 'data.xml', which is located inside the osm-bright-source npm\n    npm: [\"osm-bright-source\", \"data.xml\"]\n  xmlSetDataSource: # Before loading, update the datasource section of the standard mapnik config file\n    if:             # Only update datasources that match all these values (logical AND)\n      dbname: gis   # Instead of 'gis', you can use {npm:...}, {ref:..}, and {var:...}\n      host: ''\n      type: postgis\n    set:            # Replace these keys with the new values\n      host: localhost\n      user: {var: osmdb-user}  # Instead of hardcoding, use the value from the variables file or conf section\n      password: {var: osmdb-pswd}\n```\n\n* `xmlSetParams` - for xml, overrides the top level `<Parameters>` values with the new ones. For example, the `vector` source requires xml stylesheet to point to the proper source of PBFs:\n```\ns2:\n  public: true\n  uri: vector://\n  formats: [png,json,headers,svg,jpeg]\n  xml:\n    npm: [\"osm-bright-style\", \"project.xml\"]    # stylesheet xml is in npm\n  xmlSetParams:\n    source: {ref: gen}                          # set source parameter to the 'gen' source\n```\n* `xmlLayers` - keep all non-layer data, but only keep those layers that are listed in this value (whitelist):\n```\ns2:\n  public: true\n  uri: vector://\n  formats: [png,json,headers,svg,jpeg]\n  xml:\n    npm: [\"osm-bright-style\", \"project.xml\"]    # stylesheet xml is in npm\n  xmlLayers: ['landuse', 'road']                # Only include these layers when rendering\n```\n* `xmlExceptLayers` - same as `xmlLayers`, but instead of whitelisting, blacklist (allow all except these):\n```\ns2:\n  public: true\n  uri: vector://\n  formats: [png,json,headers,svg,jpeg]\n  xml:\n    npm: [\"osm-bright-style\", \"project.xml\"]    # stylesheet xml is in npm\n  xmlExceptLayers: ['water']                    # Exclude water layer when rendering\n```\n* `xmlSetDataSource` - change all layer's datasources' parameters if they match conditions:\n`if` is a set of parameter values that all must match,\n`xmlLayers` and `xmlExcludeLayers` just like above set which layers to address,\nand `set` specifies the new parameter values to be set.\n\nInstead of an object, `xmlSetDataSource` can be set to an array of objects to provide\nmultple change sets.\n\n## Kartotherian-specific parameters:\n* `public` (boolean) - should this be source be accessible via `/<sourceId>/z/x/y.format` requests\n* `minzoom` (int) - minimum allowable zoom for the public request (public requests only)\n* `maxzoom` (int) - maximum allowable zoom for the public request (public requests only)\n* `defaultHeaders` (object) - a set of extra headers that will be sent to the user unless the source provides its own. (public requests only)\n* `headers` (object) - a set of extra headers that will be sent to the user instead of the headers returned by the source. (public requests only)\n* `formats` (array of strings) - one string or a list of string values specifying allowed formats, e.g. `['png','jpeg']`\n* `scales` (array of numbers) - one number or a list of number values specifying allowed scalings, e.g. `[1.3, 1.5, 2, 2.6, 3]`\n",
  "readmeFilename": "README.md",
  "_id": "kartotherian-core@0.0.0",
  "_shasum": "a0fe566a2220694cf1819c285161d6840836eec2",
  "_resolved": "git+https://github.com/kartotherian/kartotherian-core.git#ee0e1fdc23c335bf17efc47ada369cc719f74636",
  "_from": "kartotherian-core@git+https://github.com/kartotherian/kartotherian-core.git"
}
